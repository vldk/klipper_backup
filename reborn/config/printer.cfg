[include steppers.cfg]
[include mainsail.cfg]
[include macroses/*.cfg]
[include probe.cfg]
[include leds.cfg]
[include K-ShakeTune/*.cfg]
# [include adxl.cfg]

[pause_resume]
recover_velocity: 50.
#   When capture/restore is enabled, the speed at which to return to
#   the captured position (in mm/s). Default is 50.0 mm/s.

# [virtual_sdcard]
# path: ~/1reborn_data/gcodes
# on_error_gcode:
#   CANCEL_PRINT

[exclude_object]

[gcode_arcs]
resolution: 0.1

[force_move]
enable_force_move: True


[mcu]
serial: /dev/ttyS3
# baud: 125000
# serial: /dev/serial/by-id/usb-Klipper_lpc1768_02F0FF19A0A447AF05DF155DC22000F5-if00
restart_method: command

# [mcu host]
# serial: /tmp/klipper_host_mcu

[mcu EBB]
canbus_uuid: ce92d9a6b810

[temperature_sensor EBB]
sensor_type: temperature_mcu
sensor_mcu: EBB
min_temp: 0
max_temp: 100


[input_shaper]
shaper_type_x = ei # vibrations = 7.2%, smoothing ~= 0.022, suggested max_accel <= 29560 mm/sec^2
shaper_freq_x = 127.0
shaper_type_y = mzv # vibrations = 1.2%, smoothing ~= 0.074, suggested max_accel <= 8060 mm/sec^2
shaper_freq_y = 52.2 

[printer]
kinematics: corexy
max_velocity: 300 #максимальные ускорения
square_corner_velocity: 5.0
max_accel: 7000
# max_accel_to_decel: 3000
minimum_cruise_ratio: 0.5
max_z_velocity: 5
max_z_accel: 70

# [temperature_sensor mcu_temp]
# sensor_type: temperature_mcu
# min_temp: -80
# max_temp: 80

[temperature_sensor orange_pi]
sensor_type: temperature_host
min_temp: 0
max_temp: 90


[firmware_retraction]
retract_length: 0.6
retract_speed: 35
unretract_extra_length: 0 # 0.1
unretract_speed: 50

[heater_bed]
heater_pin: P2.5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: P0.25
min_temp: 0
max_temp: 130
#control: pid
#pid_Kp:65.232 
#pid_Ki:1.330 
#pid_Kd:799.905

#####################################################################
#  Heater Fan + Mother Board Fan + Motors + Filter
#####################################################################
# 
# Heater & Mother Board Fan currently are always on
# 
[heater_fan heater_fan]
pin:  EBB: PA0 #P2.4 
kick_start_time: 0.4
max_power: 1.0
shutdown_speed: 0.0
heater: extruder
heater_temp: 60.0 ; Shutdown FAN at 30C
fan_speed: 1 # 0.7

[controller_fan board_fan]
pin: P2.4
# fan_speed: 0.5

# [heater_fan filter_fan]
# pin: PB2 
# kick_start_time: 0.4
# max_power: 1.0
# shutdown_speed: 0.0
# heater: heater_bed
# heater_temp: 65.0 ; Shutdown FAN at 65C, Do not use for PLA
# fan_speed: 0.3

# [fan_generic motors]
# pin: PB2
# #cycle_time:
# #hardware_pwm:
# #enable_pin:
# kick_start_time: 0.4
# max_power: 1.0
# shutdown_speed: 0.0
# # fan_speed: 1.0
# off_below: 0.15

# [controller_fan board_fan]
# pin: P2.4
# max_power: 0.7

#####################################################################
#  Fan 2x4010 Model FAN
#####################################################################
[fan]
pin: EBB: PA1 #P2.3
max_power: 1.0
shutdown_speed: 0
cycle_time: 0.010
hardware_pwm: False
off_below: 0.10
kick_start_time: 0.4


[filament_motion_sensor filement_sensor]
switch_pin: ^P1.26
detection_length: 20 #35
extruder: extruder
pause_on_runout: True


# [temperature_sensor Enclosure]
# sensor_type: BME280
# i2c_address: 118
# i2c_bus: i2c1
# i2c_mcu: mcu
# # i2c_bus: i2c.0


# [board_pins]
# aliases:
#     # EXP1 header
#     EXP1_1=PC5,  EXP1_3=PD13,   EXP1_5=PE14, EXP1_7=PD11,  EXP1_9=<GND>,
#     EXP1_2=PE13, EXP1_4=PC6,    EXP1_6=PE15, EXP1_8=PD10,  EXP1_10=<5V>,
#     # EXP2 header
#     EXP2_1=PA6, EXP2_3=PE8,  EXP2_5=PE11, EXP2_7=PE12,  EXP2_9=<GND>,
#     EXP2_2=PA5, EXP2_4=PE10, EXP2_6=PA7,  EXP2_8=<RST>, EXP2_10=<3.3V>

[idle_timeout]
gcode:
   TURN_OFF_HEATERS
   M84             ; disable steppers
timeout: 18000      ;5 hours

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 58.622
#*# pid_ki = 1.329
#*# pid_kd = 646.309
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.401
#*# pid_ki = 0.936
#*# pid_kd = 80.913
#*#
#*# [probe]
#*# z_offset = 9.220
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.151667, -0.165000, -0.176250, -0.175000, -0.178750, -0.180000, -0.177083, -0.181667, -0.165000, -0.151667, -0.142083, -0.150000
#*# 	-0.176667, -0.188750, -0.198750, -0.210000, -0.209167, -0.205417, -0.194583, -0.192500, -0.172917, -0.167917, -0.161250, -0.165000
#*# 	-0.206250, -0.215000, -0.228333, -0.244583, -0.236667, -0.220417, -0.205833, -0.194167, -0.176250, -0.170833, -0.164583, -0.172500
#*# 	-0.208333, -0.220000, -0.242917, -0.253333, -0.255000, -0.229583, -0.215000, -0.207500, -0.188750, -0.180833, -0.180000, -0.196667
#*# 	-0.215417, -0.234583, -0.260417, -0.262917, -0.256667, -0.235833, -0.217917, -0.212083, -0.190000, -0.182917, -0.182917, -0.197917
#*# 	-0.211250, -0.208750, -0.232083, -0.237083, -0.212500, -0.195000, -0.192083, -0.194167, -0.172500, -0.160417, -0.168333, -0.197083
#*# 	-0.222917, -0.235417, -0.243750, -0.245833, -0.232500, -0.215000, -0.210417, -0.201667, -0.185417, -0.165417, -0.169167, -0.203750
#*# 	-0.249167, -0.246667, -0.258750, -0.254583, -0.250000, -0.243750, -0.236250, -0.239583, -0.206250, -0.189583, -0.181667, -0.202500
#*# 	-0.230417, -0.227500, -0.243750, -0.245000, -0.239583, -0.238333, -0.226667, -0.221250, -0.194167, -0.163750, -0.167500, -0.183333
#*# 	-0.190833, -0.179583, -0.190000, -0.205000, -0.207500, -0.194583, -0.195417, -0.202500, -0.178333, -0.145833, -0.142500, -0.160417
#*# 	-0.140833, -0.135417, -0.152083, -0.162083, -0.162500, -0.160000, -0.160833, -0.173750, -0.142917, -0.121250, -0.126667, -0.154167
#*# 	-0.112500, -0.105417, -0.107917, -0.119167, -0.119583, -0.122917, -0.130417, -0.139583, -0.118750, -0.100833, -0.101667, -0.117083
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = bicubic
#*# y_count = 12
#*# mesh_y_pps = 2
#*# min_y = 25.0
#*# x_count = 12
#*# max_y = 294.94
#*# mesh_x_pps = 2
#*# max_x = 294.94
#*#
#*# [bed_mesh stock2]
#*# version = 1
#*# points =
#*# 	0.211338, 0.197588, 0.195921, 0.158004, 0.131754, 0.158421, 0.200088
#*# 	0.150088, 0.119671, 0.099254, 0.081754, 0.033421, 0.060088, 0.092588
#*# 	0.090088, 0.065088, 0.035921, -0.001579, -0.008662, 0.000088, 0.062588
#*# 	0.105504, 0.089254, 0.065504, 0.034254, 0.003838, 0.002171, 0.076754
#*# 	0.067588, 0.049671, 0.031338, 0.000088, -0.016162, -0.005329, 0.067588
#*# 	0.079671, 0.079671, 0.080921, 0.060504, 0.047588, 0.065504, 0.123838
#*# 	0.110504, 0.115088, 0.127588, 0.119671, 0.109254, 0.130504, 0.197588
#*# tension = 0.2
#*# min_x = 50.0
#*# algo = bicubic
#*# y_count = 7
#*# mesh_y_pps = 2
#*# min_y = 25.0
#*# x_count = 7
#*# max_y = 310.0
#*# mesh_x_pps = 2
#*# max_x = 320.0
#*#
#*# [bed_mesh glass_old]
#*# version = 1
#*# points =
#*# 	0.182750, 0.168167, 0.165667, 0.158583, 0.153583, 0.160667, 0.129417, 0.124417, 0.155667, 0.176083, 0.221500, 0.157750
#*# 	0.134833, 0.116500, 0.093583, 0.087750, 0.069417, 0.076500, 0.062333, 0.076500, 0.110667, 0.122750, 0.156500, 0.095250
#*# 	0.077333, 0.074417, 0.054417, 0.044833, 0.066083, 0.067750, 0.051083, 0.074417, 0.109000, 0.113583, 0.121500, 0.064833
#*# 	0.060250, 0.049833, 0.043167, 0.044417, 0.050250, 0.052750, 0.047750, 0.059833, 0.080667, 0.089417, 0.112333, 0.024417
#*# 	0.064417, 0.041917, 0.038167, 0.050667, 0.072333, 0.069417, 0.048583, 0.079000, 0.104417, 0.122333, 0.124417, 0.046083
#*# 	0.071083, 0.049833, 0.040667, 0.042333, 0.063167, 0.071500, 0.058583, 0.078583, 0.104417, 0.111083, 0.114000, 0.020667
#*# 	0.107333, 0.086083, 0.081083, 0.093167, 0.107333, 0.114833, 0.109833, 0.131083, 0.157750, 0.168583, 0.148167, 0.066917
#*# 	0.081500, 0.073167, 0.067750, 0.069417, 0.080250, 0.088583, 0.084417, 0.111083, 0.150250, 0.154833, 0.160667, 0.079417
#*# 	0.087333, 0.074833, 0.071500, 0.071917, 0.076500, 0.075667, 0.069000, 0.101917, 0.134417, 0.146083, 0.137333, 0.063583
#*# 	0.098583, 0.076500, 0.059833, 0.060250, 0.059417, 0.057333, 0.043167, 0.066500, 0.111917, 0.129417, 0.131083, 0.049833
#*# 	0.116917, 0.094000, 0.078583, 0.064000, 0.052750, 0.044000, 0.021500, 0.041500, 0.075667, 0.086083, 0.091500, 0.050667
#*# 	0.115667, 0.158583, 0.085250, 0.079000, 0.080667, 0.064417, 0.041500, 0.061083, 0.098583, 0.117333, 0.118167, 0.117750
#*# tension = 0.2
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 40.7
#*# min_y = 6.8
#*# y_count = 12
#*# mesh_y_pps = 2
#*# x_count = 12
#*# max_x = 310.64
#*# max_y = 299.73
#*#
#*# [bed_mesh glass]
#*# version = 1
#*# points =
#*# 	0.073750, 0.061667, 0.047500, 0.046250, 0.042917, 0.038750, 0.037917, 0.027500, 0.042917, 0.054167, 0.053333, 0.040417
#*# 	0.027917, 0.018750, 0.011250, 0.002083, -0.000417, 0.007083, 0.009167, 0.010833, 0.026667, 0.028333, 0.030833, 0.023750
#*# 	0.005833, -0.002500, -0.014583, -0.027083, -0.022083, -0.012083, 0.003333, 0.003750, 0.017083, 0.016667, 0.020417, 0.011667
#*# 	-0.000417, -0.015000, -0.034167, -0.045417, -0.043333, -0.025000, -0.013750, -0.008750, 0.004583, 0.009583, 0.007500, -0.020417
#*# 	-0.008333, -0.028750, -0.052917, -0.056250, -0.053333, -0.035000, -0.022500, -0.019167, -0.001667, 0.002917, 0.000833, -0.022500
#*# 	-0.003750, -0.005000, -0.025417, -0.033333, -0.010417, 0.005833, 0.006250, 0.002917, 0.017917, 0.026250, 0.015833, -0.020000
#*# 	-0.014583, -0.025833, -0.037083, -0.039583, -0.028333, -0.014167, -0.012083, -0.007083, 0.007917, 0.023750, 0.015000, -0.025833
#*# 	-0.038750, -0.037500, -0.049583, -0.047500, -0.043750, -0.039583, -0.036250, -0.040417, -0.015417, -0.000000, 0.003750, -0.020833
#*# 	-0.018333, -0.017917, -0.035833, -0.037917, -0.034167, -0.033750, -0.025833, -0.022917, 0.002083, 0.026667, 0.019167, 0.001667
#*# 	0.021250, 0.030000, 0.018333, 0.001250, -0.002500, 0.009167, 0.003750, -0.005833, 0.016667, 0.044583, 0.044167, 0.023333
#*# 	0.075000, 0.075833, 0.061667, 0.046667, 0.042917, 0.042500, 0.037083, 0.021250, 0.047500, 0.065833, 0.057500, 0.026250
#*# 	0.097083, 0.101667, 0.097917, 0.086250, 0.084583, 0.079167, 0.067917, 0.055417, 0.074167, 0.091667, 0.088333, 0.065000
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = bicubic
#*# y_count = 12
#*# mesh_y_pps = 2
#*# min_y = 25.0
#*# x_count = 12
#*# max_y = 294.94
#*# mesh_x_pps = 2
#*# max_x = 294.94
